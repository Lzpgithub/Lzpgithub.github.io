---
layout: post
title: 四轴飞行器地面基站软件系统的设计
categories: 个人项目
description: 四轴飞行器地面基站软件系统的设计
keywords:  QT，Opencv软件开发库
---

本项目主要是基于C++界面开发库QT平台和Opencv软件开发库设计四轴飞行器地面基站系统，主要实现的功能是控制四轴飞行器（包括启动、停机、加油门），实时监测飞行器的四个螺旋桨的油门量程，实时显示飞行器的俯仰角、偏航角和滚转角示数，实时绘画三角度的变化曲线，通过立体坐标系实时显示飞行器的飞行姿态，以便于调整各种飞行参数例如pid参数。

该项目本来源于自己设计的微型四轴飞行器。通过自己设计电路，pcb打板，stm32嵌入式编程，通过蓝牙模块控制飞行器。总体硬件部分已经搭好，接下来的调整飞行器参数却遇到问题，因为无法实时知道飞行器的飞行姿态，也就无法调整飞行参数。因此编写了一个四轴飞行器地面基站软件系统，专门控制飞行器和监测飞行姿态。四轴飞行器通过无线蓝牙模块实时给pc发送数据，pc通过飞行器地面基站软件系统接收数据并发送控制命令。

![](/images/posts/Projection/29.png)

#### 串口发送和接收数据

四轴飞行器地面基站软件系统首先要接收飞行器发送过来的数据，因此该软件系统本身就是一个串口接收系统。因此必须使得软件系统实现串口接收数据。在Qt中并没有特定的串口控制类，现在大部分人使用的是第三方写的qextserialport类，我们这里也是使用的该类来实现串口接收和发送数据。

把相应的qextserialport类包含在工程中，还要修改一些其他细节，包括设置相关参数例如波特率、校验位等等，这些都通过QT的窗口部件来实现：

```cpp
ui.cb_ComNumber->insertItem("COM1",0);      //串口号的初始化
ui.cb_ComNumber->insertItem("COM2",1);
ui.cb_ComNumber->insertItem("COM3",2);
ui.cb_ComNumber->insertItem("COM4",3);
ui.cb_ComNumber->insertItem("COM5",4);
ui.cb_ComNumber->insertItem("COM6",5);
ui.cb_ComNumber->insertItem("COM7",6);
ui.cb_ComNumber->insertItem("COM8",7);
ui.cb_ComNumber->insertItem("COM9",8);
ui.cb_ComNumber->insertItem("COM10",9);

ui.cb_BaudRate->insertItem("9600",0);       //波特率的初始化
ui.cb_BaudRate->insertItem("115200",1);

ui.cb_OddEven->insertItem("NONE",0);        //校验位初始化
ui.cb_OddEven->insertItem("ODD",1);
ui.cb_OddEven->insertItem("EVEN",2);

ui.cb_DataBits->insertItem("8",0);          //数据位初始化
ui.cb_DataBits->insertItem("7",1);
ui.cb_DataBits->insertItem("6",2);
```

![](/images/posts/Projection/50.png)

如上图为系统的调试模块，这部分的功能包括设置串口的参数例如波特率、校验位和数据位，选择对应的串口号。点击打开串口按钮，软件系统即可和飞行器进行通信。上面的数据接收框可以实时显示飞行器发送过来没有经过解码的数据，点击发送数据按钮，在发送数据框中填写相应的指令，也可以给飞行器发送相应的指令例如启动、加油门等等。点击关闭串口按钮即可断开系统与飞行器的通信连接。















