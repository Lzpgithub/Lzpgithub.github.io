---
layout: post
title: 基于移动终端的智能口罩与PM检测系统
categories: 个人项目
description: 基于移动终端的智能口罩与PM检测系统
keywords:  QT，Opencv软件开发库
---

随着社会的不断进步，工业污染问题也越发突出。而由空气污染导致的呼吸道疾病的人数也在持续上升。同时，人体呼吸信号作为监测健康状况的重要依据，可以及时发现人体是否患有呼吸道疾病。因此，检测人体呼吸节律，识别异常呼吸信号，实时监测人体的健康状况，变得尤为重要。面对空气污染，人们纷纷佩戴口罩，但传统的口罩只有单一的过滤空气功能，无法满足人们的需求。因此本队为追求健康的人群量身打造一款即具有净化空气的传统功能，还兼具呼吸监测、空气PM浓度检测及用户跌倒监测等主要功能的多功能智能口罩。

智能口罩采用MSP430单片机控制三维加速度模块、呼吸模块及PM模块并通过蓝牙实时发送数据，移动终端实现用户的人性化界面和数据的算法处理。用户在使用过程中能够实时监测自身的呼吸情况，了解周围的PM情况并实现重污染预警，规划PM空气污染最小路径。如若用户在跑步时不慎跌倒，系统将及时发出报警信号，以避免不必要的悲剧。多功能智能口罩是未来移动医疗的趋势，为人们的生活带来了科技力量的便利。


相对于传统口罩的过滤功能，本队设计的多功能口罩拥有许多智能的功能。

其一本口罩可实现对人体呼吸的检测，并对日常的呼吸节律实时监控，包括对呼吸异常、呼吸量的识别等。健康热爱跑步运动的人和上班族可以对日常活动进行呼吸监控，检测人体的呼吸健康情况，同时保存呼吸数据，给医生提供呼吸疾病的诊断依据。

其二为PM检测并实现路径规划。本口罩可以实时监控空气中的PM浓度值，当空气中PM浓度值超标的时候及时报警，提醒用户带上口罩。但PM浓度值处于正常水平下，用户可以脱下口罩，挂在脖子上，十分便携。同时，智能口罩也能利用GPS定位、无线传送和手机终端等技术采集每个用户在每个地点的PM值空气情况，并将该信息发送到手机网络终端，实现信息共享。移动网络终端对该数据进行分析，算出PM值最小路径，为出行者选择最佳的路径，避开污染严重区域。

其三为跌倒检测。健康热爱跑步运动的人在户外运动时候容易跌倒摔伤或由于血糖低导致晕眩，本口罩针对上述情况设计了跌倒检测功能及时报警并通知用户的紧急联系人，以避免不必要的悲剧。
其四为高集成化。本口罩精简电路较小，并美观设计使用户便于携带。

#### 方案论证与设计

为了实现多功能口罩的智能功能，系统的总体结构可分为硬件系统和软件系统。其中硬件系统包括空气过滤模块、呼吸信号采集模块、PM值测量模块、单片机控制模块、无线发送模块、跌倒检测模块、电源模块和手机移动终端。

![](/images/posts/Projection/56.png)

其中硬件系统设计流程图如下图2-2所示：

![](/images/posts/Projection/57.png)

智能口罩硬件系统由电源模块供电，用户通过棉花、活性炭等过滤装置过滤空气，单片机同时采集呼吸信号、PM信号和三维重力加速度信号，通过中断响应按照一定的规则通过蓝牙发送至手机终端，手机终端进行数据后处理。

其中软件系统设计流程图如下图2-3所示：

![](/images/posts/Projection/58.png)

智能口罩软件系统完成了用户界面及呼吸数据、PM数据、跌倒信息数据的接收和处理，并按照一定的需求进行波形显示。软件实现了五大功能，分别为实时绘制、查看记录、呼吸分析、跌倒检测、PM路径规划。软件能够对呼吸、跌倒情况、PM情况进行健康监测。人体呼吸数据及跌倒信号发生异常时，手机会提供警报。跌倒异常会自动通知紧急联系人。用户能够采集查询当地的PM情况，并选择最优的空气路径来避开污染区。同时用户的呼吸数据将作为用户的健康指标进行保存分析以便于医生和用户的参考。


#### 用户帮助模块

在帮助模块中，软件为用户提供了呼吸健康知识以及国家PM评定标准。如下图所示。

![](/images/posts/Projection/65.png)

#### 用户数据库模块

用户数据库模块实现了用户注册以及登录功能。数据库是按照数据结构来组织、存储和管理数据的仓库，数据管理不再仅仅是存储和管理数据，而转变成用户所需要的各种数据管理的方式。数据库有很多种类型，从最简单的存储有各种数据的表格到能够进行海量数据存储的大型数据库系统都在各个方面得到了广泛的应用。用户在软件中输入自己的个人信息、账号名、密码、第一紧急联系人和第二紧急联系人等资料进行注册。

![](/images/posts/Projection/66.png)

#### 蓝牙软件处理模块

蓝牙硬件为XM-15BSPP，波特率为9600HZ。软件通过蓝牙协议与其相连接。其中采样率100HZ，能够保证低频呼吸信号的采集不失真。首先点击打开蓝牙，接着进行设备搜索，选择目标蓝牙设备后蓝牙即可连接。如下图为蓝牙成功连接状态。

![](/images/posts/Projection/67.png)

#### 软件采集模块

在蓝牙连接成功后，即可进行数据的采集。点击画出波形，呼吸数据与PM数据将同时实时绘制在界面上。其中蓝线为呼吸信号，红线为PM信号。分别如下图所示。在采集的同时，呼吸速率将被实时计算显示在主界面上，此时分析呼吸速率为短时间的呼吸速率值。下图呼吸速率为18。

![](/images/posts/Projection/68.png)

![](/images/posts/Projection/69.png)

#### 数据分析模块

在采集过程中通过点击保存按钮，将所需要的数据进行保存。返回登录即可退出采集。接着点击查看记录，PM数据文件PM.txt，PMLOCATION位置信息文件PMLOCATION.txt，呼吸数据文件

2015-03-16_22_02_22.txt显示在主界面中。点击呼吸数据文件即可查看刚才采集的呼吸数据。

![](/images/posts/Projection/70.png)

查看完了数据，根据呼吸健康判定标准，点击呼吸分析即可对呼吸文件是2015-03-16_22_02_22.txt进行分析。此时分析呼吸速率为长时间（一段时间）的呼吸速率值。分析得到的结果为15，呼吸正常。如下图所示。

![](/images/posts/Projection/71.png)

目前，传统算法采用阈值法获取呼吸速率，这种方法误差高，可信度低。本文根据呼吸信号的特点采用自主设计的方法，通过MATLAB仿真先是对信号进行高低通均值滤波，保证信号的信噪比高，然后对信号进行特殊标定准确快速地寻找出峰峰值实时提取出呼吸速率。因此算法准确性高。

#### PM路径规划模块

在数据采集过程中得到了PM数据，将其从保存的文件中逐一读取他们的地理经纬度信息及PM值信息，根据冒泡算法求得在空气污染轻度污染以上的位置最优路径连线来方保证用户的健康出行。

![](/images/posts/Projection/72.png)

#### 跌倒检测模块

在用户注册的时候需要填写第一紧急联系人和第二紧急联系人。其中第一紧急联系人为发生紧急状况下首先通知的人员，同时开启警报模块。如若用户在15分钟内未关闭警报或未操作软件，将会通知紧急联系人二。如若30分钟警报未关闭未操作软件，系统将自动通知120。

![](/images/posts/Projection/73.png)


#### 口罩空气过滤模块

口罩空气过滤模块主要使用过滤器进行过滤，位于口罩主侧，过滤器和口罩体之间有接口，可以固定在口罩的两侧。过滤器内我们填充了一定比例的棉花和活性炭，增强对空气中的粉尘、灰尘等微小颗粒的过滤强度。

#### 呼吸传感器信号采集模块

呼吸信号采集电路，主要是传感器电路、前级放大电路、高低、通滤波电路、后级放大电路以及电源供电电路。主要原理是通过检测口腔内呼气和吸气时温度的变化信号，把温度信号转换为电信号。所有这些电路集成在一块3cmx3cm的PCB板上。

![](/images/posts/Projection/59.png)

采集出来的呼吸信号经过上述一系列电路的处理，经过示波器显示得到相当完美的波形。

![](/images/posts/Projection/60.png)


#### PM空气质量传感器模块

PM空气质量值传感器模块我们采用日本的粉尘GP2Y1010AU0F传感器。该传感器利用光学灰尘浓度检测原理，依靠脉冲的高度来判断颗粒的浓度。可测量0.8微米以上的微小粒子,能灵敏得感知烟气、花粉、PM2.5等细小颗粒。

![](/images/posts/Projection/61.png)

![](/images/posts/Projection/62.png)


其中数据在0到670之间，表示空气质量等级为好。

#### 微控制和蓝牙发送模块

本系统中，我们采用了TI德州仪器msp430f149 16位超低功耗单片机来作为本系统的微控制器。msp430f149具有12位精度AD，16位定时器，支持8M时钟，像我们的PM传感器就需要严格高速的时序，而msp430就完全符合这个要求。单片机系统主要是采集呼吸检测模块和PM值测量模块的电信号，通过电平抬升电路，将电信号转化为数字信号，再将数字信号数据通过蓝牙无线模块发给手机终端程序。
编写单片机AD采集程序，把呼吸检测模块出来的模拟电信号接到单片机的模拟电压采集端口，完成信号的采集，通过单片机采集PM值测量模块电信号，经过一系列的换算，得到空气中PM浓度值。完成以上功能的所有电路也集成在2cmx2cm的PCB板，从而可以轻松地安装在口罩上。

![](/images/posts/Projection/63.png)


#### 跌倒检测模块

三轴加速度传感器模块采用ADXL335是一款小尺寸、薄型、低功耗、完整的三轴加速度计，提供经过信号调理的电压输出，能以最小±3 g的满量程范围测量加速度。它可以测量倾斜检测应用中的静态重力加速度，以及运动、冲击或振动导致的动态加速度。

用户使用CX、CY和 CZ引脚上的电容 XOUT、YOUT和ZOUT选择该加速度计的带宽。可以根据应用选择合适的带宽，X轴和Y轴的带宽范围为0.5 Hz至1600 Hz，Z轴的带宽范围为0.5 Hz至550 Hz。ADXL335提供小尺寸、薄型、16引脚、4 mm × 4 mm × 1.45 mm塑料引脚架构芯片级封装(LFCSP_LQ)。该传感器通过单片机向手机端发送其数据。

![](/images/posts/Projection/64.png)

本项目软件系统通过蓝牙模块从硬件系统接收到呼吸数据、PM数据及用户运动状况信号。软件部分实现了友好的用户界面，为用户建立数据库，方便用户的注册登录。与此同时软件部分还将实时绘制接收到的呼吸信号、PM信号及用户运动状况信号，并作出相应的分析。根据分析的结果就行呼吸健康诊断以及PM最优路径规划，让口罩能够智能得成为用户抵挡雾霾的智能盾牌。同时三维加速度传感器进行用户运动状况进行监测，如果跌倒单片机发送异常的用户运动状况信号给手机端，手机端接收发送摔倒地理信息并发送给紧急联系人，以避免不必要的悲剧。






















