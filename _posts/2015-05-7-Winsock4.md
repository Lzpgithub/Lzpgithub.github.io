---
layout: post
title: 网络配置信息查询--WinSock编程
categories: 计算机网络
description:  WinSock编程
keywords: WinSock
---

在编写程序时，有事需要获取计算机的名字、IP地址以及网络服务或是网络协议相关信息，WinSock提供了一系列函数来帮助应用程序完成相应的信息查询操作。

##### 主机名字与IP地址查询

1.gethostname()

功能：该函数用于查询本地计算机主机的名字。

原型：int gethostname(char *name,int namelen);

参数：

name:指向用于存放主机名字的缓冲区，就是一个字符数组。

namelen:是缓冲区的大小，也就是字符数组name的大小。

若函数调用成功则返回0。

2.gethostbyname()

功能：该函数可根据主机名字查询主机的IP地址等信息，该查询操作就是通常所谓的"域名解析"。

原型：struct hostent *gethostbyname(const char *name);

参数：name指向主机的名字的字符指针(字符串)，该名字除了可以是本机的名字外，还可以是网上任一台主机的域名(DNS)。

函数调用成功，则返回一个指向hostent结构指针。

```cpp
struct hostent{
	char *h_name;         //主机的规范名
	char **h_aliases;     //指向主机的别名列表
	int h_addrtype;       //主机IP地址类型(AF_INET表示IPv4)
	int h_length;         //主机IP地址长度(4)
	char **h_addr_list;   //主机IP地址列表(网络字节顺序);
}
```

程序例子：

```cpp
#include "WinSock2.h"                 //包含WinSock库头文件
#include <iostream>
#pragma comment(lib,"ws2_32.lib")     //链接WinSock导入库

using namespace std;

int main(){
	struct hostent *hptr;
	char **pptr;
	char hostname[256];               //用于存放获取本机名称或输入的远程主机域名
	//加载WinSock DLL
	WSADATA wsaData;
	WORD wVersionRequested=MAKEWORD(2,2);
	if(WSAStartup(wVersionRequested,&wsaData)!=0){
		cout<<"加载WinSock DLL失败!"<<endl;
		return 0;
	}
	if(gethostname(hostname,sizeof(hostname))){    //获取本机名字
		cout<<"获取主机名字失败!"<<endl;
		WSACleanup();
		return 0;
	}
	cout<<"本机名字为："<<hostname<<endl;
	if((hptr=gethostbyname(hostname))==NULL){     //获取本机IP地址
		cout<<"通过主机名获取本机IP地址失败!"<<endl;
		WSACleanup();
		return 0;
	}

	//输出IP地址
	pptr=hptr->h_addr_list;
	cout<<"本机IP地址："<<endl;                              
	while(*pptr!=NULL){                                    //循环是因为一个主机可能存在多个IP地址
		cout<<inet_ntoa(*(struct in_addr *)(*pptr))<<endl; //(struct in_addr *)为强制类型转换
		pptr++;
	}

	//从键盘中输入要解析的网站域名
	cout<<"输入要解析的域名:"<<endl;
	cin>>hostname;
	if((hptr=gethostbyname(hostname))==NULL){          //解析输入的网站域名
		cout<<"名字解析失败!"<<endl;
		WSACleanup();
		return 0;
	}
	//输出远程主机IP地址
	pptr=hptr->h_addr_list;
	cout<<"主机IP地址："<<endl;
	while(*pptr!=NULL){            //(struct in_addr *)为强制类型转换
		cout<<inet_ntoa(*(struct in_addr *)(*pptr))<<endl;  
		pptr++;
	}
	WSACleanup();

	system("pause");
}
```








